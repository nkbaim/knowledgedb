---
title: 系统管理
date: 2021-06-17 21:08:48
permalink: /linux/system/
categories:
  - Linux相关
tags:
  - system
  - 权限
---


## 一、用户管理

### 1. 用户创建与删除

- 创建用户
创建用户有两个命令，`adduser` 和 `useradd`
- `adduser` 会自动为创建的用户指定主目录、系统shell版本，会在创建时输入用户密码。
- `useradd` 需要使用参数选项指定上述基本设置，如果不使用任何参数，则创建的用户无密码、无主目录、没有指定shell版本。

```bash
# 创建用户
useradd user1

# 此命令新建了一个用户 user1，该用户的登录 Shell 是 /bin/sh，他属于 group1 用户组，
# 同时又属于 group2,group3用户组，其中 group1 用户组是其主组。
useradd -s /bin/sh -g group1 -G group2,group3 user1
# -s 指定新用户登陆时shell类型，比如这个中指定新用户 username 使用的 shell 是  /bin/bash  
# -g 指定所属组，该组必须已经存在，此例中所属组是 name 组。
# -G 指定附属组，该组必须已经存在
# -d 用户家目录
# -m 用户家目录不存在时，自动创建该目录

# 修改用户密码
passwd user1
```

useradd参数说明：

- 删除用户
```bash
# 只删除用户
userdel user1

# 同时删除用户和用户的主目录
userdel -r user1
```


### 2. 用户组管理

```bash
# 1. 查看用户所在组
groups user1

# 2. 将用户添加到次要组或者附加组
# 将user1添加到group1
usermod -a -G group1 user1
gpasswd -M user1 group1

# 将user1添加到多组个组
usermod -a -G group1,group2 user1

# 将多个用户添加到组
gpasswd -M user1,user2 group1

# 修改用户的主要组
usermod -g group1 user1

# 3. 将用户从组中删除
gpasswd -d user1 group1

```

### 3. 创建系统管理员

```bash
# 编辑/etc/sudoers 文件

# 1. 添加文件写权限。 chmod u+w /etc/sudoers

# 2. 编辑/etc/sudoers，增加一行如下： 用户名 ALL=(ALL) ALL，保存退出
username ALL=(ALL) NOPASSWD: ALL

# 3. 撤销写权限。chmod u-w /etc/sudoers
```

## 二、权限管理


## 三、文件操作

### 1. 查看文件指定行数

```bash
# e.g. 查看文件第10-30行
cat file.txt |tail -n +10 |head -n 20
```

## 四、系统管理

### 1. 防火墙管理
1. 开启防火墙服务
```bash
systemctl start firewalld.service
systemctl stop firewalld.service
systemctl restart firewalld.service
```

2. firewall-cmd常用命令
```bash
# 查看当前所有规则
firewall-cmd --list-all

# 添加端口
firewall-cmd --zone=public --add-port=443/tcp —permanent

# 删除端口
firewall-cmd --zone=public --remove-port=443/tcp —permanent

# 应用规则
firewall-cmd --reload

#
# 命令含义：
# –-zone 作用域
# –-add-port=80/tcp #添加端口，格式为：端口/通讯协议
# –-permanent #永久生效，没有此参数重启后失效

# 禁用某个IP访问服务器  
firewall-cmd --permanent --add-rich-rule='rule family=ipv4 source address="10.10.16.2" drop'

# 禁用一个IP段
firewall-cmd --permanent --add-rich-rule='rule family=ipv4 source address="10.10.16.0/24" drop'

# 删除之前添加的规则(禁用某个IP访问服务器)
firewall-cmd --permanent --remove-rich-rule='rule family=ipv4 source address="10.10.16.2" drop'

# 指定IP授权访问
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.10.16.2" port protocol="tcp" port="22" accept'

firewall-cmd --add-rich-rule='rule family="ipv4" source address="114.246.34.8" port protocol="tcp" port=“3306" accept'

firewall-cmd --add-rich-rule='rule family=ipv4 source address=192.168.87.19 port protocol=tcp port=3306 accept'

# 拒绝(指定IP授权访问)
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.10.16.2" port protocol="tcp" port="22" drop'

# 移除(指定IP授权访问)
firewall-cmd --permanent --remove-rich-rule='rule family="ipv4" source address="10.10.16.2" port protocol="tcp" port="22" accept'

# 指定ip访问端口段
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.142.166" port protocol="tcp" port="30000-31000" accept'

```

**注意**: 每次修改后记得要 `firewall-cmd --reload` 重新加载一下
